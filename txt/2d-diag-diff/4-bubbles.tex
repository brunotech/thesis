%!TEX root = ../../THESIS.tex

\subsection{Bubbles and the chain rule} \label{4-bubbles}

Sections~\ref{subsection:dagger-sums-bubbles} and \ref{subsection:monoidal-daggers-sums-bubbles} have introduced \emph{bubbles}, diagrammatic gadgets for representing arbitrary operators on the homsets of a monoidal category.
In particular, the element-wise application of any rig-valued function $\beta : \S \to \S$ yields a bubble on the category of matrices $\beta : \mathbf{Mat}_\S(m, n) \to \mathbf{Mat}_\S(m, n)$.
When the bubble has a derivative $\partial \beta$, we may define the gradient of bubbled diagrams with the chain rule $\partial(\beta(f)) = (\partial \beta)(f) \times \partial f$.
In order to make sense of the multiplication, we assume that the homsets of our category have a product on homsets which is compatible with the sum\footnote
{That is, each homset forms a rig. Note that we do not assume that products are compatible with composition, in other words $\mathbf{C}$ need not be rig-enriched.}
and which commutes with the tensor.
For example, each homset $\mathbf{Mat}_\S(m, n)$ is a rig with entrywise sums and products.
More generally, the homsets of any hypergraph category with sums form a rig, where the product is given by pre/post-composition with the co/monoid structure.
We get the following equation:
$$\tikzfig{img/diag-diff/4-2-chain-rule}$$
For scalar diagrams, spiders are empty diagrams and the
equation simplifies to the usual chain rule.

As we have seen in example~\ref{example:neural-net}, we can encode the architecture of any neural network as a diagram with sums and bubbles for the non-linearity.
Thus, we can draw both a parametrised quantum circuit and its classical
post-processing as one bubbled diagram. By applying the
product rule to the quantum circuit and the chain rule to its post-processing,
we can compute a diagram for the overall gradient. This applies to
parametrised quantum circuits seen as machine learning models
\cite{BenedettiEtAl19}, to the patterns of measurement-based quantum
computing seen as ZX-diagrams \cite{DuncanPerdrix10} as well as quantum
natural language processing.

For now, we have only defined gradients of diagrams with respect to one
parameter at a time. In future work, we plan to extend our definition to
compute the Jacobian of a tensor with respect to a vector of variables.
Other promising directions for research include the study of diagrammatic
differential equations, opening the door to studying e.g. the Schr√∂dinger equation with diagrams.
